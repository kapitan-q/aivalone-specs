# Specification: Aivalone Project (V2 - Distributed Architecture)

## 1. Общее описание
**Aivalone** — SaaS-платформа для мониторинга и фильтрации Telegram-контента. Система построена на базе микросервисного взаимодействия Python (обработка данных) и PHP/Symfony (бизнес-логика).

## 2. Архитектура системы

### 2.1. Python Service (Telegram Bridge)
Специализированный сервис на **Python** (библиотеки Telethon или Pyrogram) для прямого взаимодействия с Telegram API.
* **Подписки:** Мониторинг новых сообщений в публичных и приватных (Base/Premium) группах в реальном времени.
* **Event Driven:** Подписка на событие `NewMessage`.
* **Ingestion Queue:** При получении сообщения сервис не обрабатывает его сам, а мгновенно пересылает сырые данные в очередь (RabbitMQ/Redis) для обработки основным бекендом.
* **Command Execution:** Выполнение технических заданий от PHP-сервиса (присоединение к новым группам, проверка статуса сессий).

### 2.2. PHP Symfony Service (Core Backend)
Основной монолит (с потенциалом разделения на микросервисы), отвечающий за бизнес-логику.
* **User Management:** Регистрация, личный кабинет, управление тарифами.
* **Task Generator:** Формирование заданий для Python-сервиса (какие группы слушать).
* **Message Processor:** Получение сообщений из очереди, применение фильтров (Free/Base), сохранение истории.
* **Delivery:** Пересылка итогового результата пользователю через основного бота.
* **Payments:** Интеграция с платежными шлюзами.

### 2.3. AI Integration Service
Отдельный слой или сервис для работы с тяжелыми вычислениями.
* **Semantic Analysis:** Обработка запросов для тарифа Premium.
* **Computer Vision:** Модуль для OCR и анализа изображений.
* **Interface:** Взаимодействие с внешними API (OpenAI/Gemini) или локальными моделями.

### 2.4. Nuxt.js Frontend (Web Interface)
* **Landing:** Маркетинговая часть, описание преимуществ Aivalone.
* **Pricing:** Динамическая таблица тарифов (Free/Base/Premium).
* **WebApp:** Личный кабинет для настройки источников и фильтров.
* **Integration:** Взаимодействие с Symfony через REST API.

## 3. Схема взаимодействия (Data Flow)
1.  **Пользователь** через Telegram-интерфейс (Symfony) добавляет группу.
2.  **Symfony** отправляет команду в **Python Service** начать мониторинг.
3.  **Python Service** ловит новое сообщение в группе → отправляет его в **Очередь**.
4.  **Symfony** забирает сообщение → применяет фильтры.
5.  Если фильтр **Premium** — Symfony делает запрос к **AI Service**.
6.  При успехе **Symfony** отправляет отфильтрованное сообщение пользователю.

## 4. Тарифная сетка (SaaS Models)

| Функция | **Free** | **Base** | **Premium** |
| :--- | :--- | :--- | :--- |
| **Лимит групп** | До 5 публичных | Без ограничений | Без ограничений |
| **Типы групп** | Только публичные | Публичные + Приватные | Публичные + Приватные |
| **Авторизация** | Не требуется | Требуется (TG Auth) | Требуется (TG Auth) |
| **Фильтрация** | Точное вхождение | Морфология (PHP) | **AI (Semantic/Vision)** |
| **Стек** | Python + Symfony | Python + Symfony | Python + Symfony + AI |

## 5. Технологический стек
* **Backend:** PHP 8.x (Symfony Framework).
* **Telegram Engine:** Python 3.x (Telethon/Pyrogram).
* **Очереди:** RabbitMQ или Redis.
* **База данных:** PostgreSQL.
* **AI:** OpenAI API / LangChain (Python).