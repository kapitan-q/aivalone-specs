# –§–∏–ª—å—Ç—Ä—ã

## –û–±–∑–æ—Ä

–§–∏–ª—å—Ç—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–∞—Ö Telegram.

## –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å

### Filter

**–ü–æ–ª—è:**
- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `ownerId` - –í–ª–∞–¥–µ–ª–µ—Ü —Ñ–∏–ª—å—Ç—Ä–∞ (UserId)
- `name` - –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞
- `chatId` - ID —á–∞—Ç–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `keywords[]` - –ú–∞—Å—Å–∏–≤ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- `enabled` - –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ñ–∏–ª—å—Ç—Ä
- `strategy` - –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è (simple/morpho/ai)
- `createdAt` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updatedAt` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è

### Simple (–ü—Ä–æ—Å—Ç–æ–π)

**–ö–æ–¥:** `simple`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ—Å—Ç–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ (case-insensitive).

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `SimpleSubstringStrategy`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UTF-8
- –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø–æ–∏—Å–∫
- –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º (OR –ª–æ–≥–∏–∫–∞)

**–ü—Ä–∏–º–µ—Ä:**
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: `["php", "laravel", "symfony"]`
- –°–æ–æ–±—â–µ–Ω–∏–µ: "–ò—â—É —Ä–∞–±–æ—Ç—É –Ω–∞ PHP"
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–∞–π–¥–µ–Ω–æ "php")

### Morpho (–ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—è)

**–ö–æ–¥:** `morpho`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ú–æ—Ä—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (PHP).

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `MorphoStrategy` (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –£—á–µ—Ç –º–æ—Ä—Ñ–æ–ª–æ–≥–∏–∏ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º —Ñ–æ—Ä–º–∞–º —Å–ª–æ–≤–∞

**–ü—Ä–∏–º–µ—Ä:**
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: `["—Ä–∞–±–æ—Ç–∞"]`
- –°–æ–æ–±—â–µ–Ω–∏–µ: "–ò—â—É —Ä–∞–±–æ—Ç—É"
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–∞–π–¥–µ–Ω–æ "—Ä–∞–±–æ—Ç—É" - –≤–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–∞–¥–µ–∂)

### AI (–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π)

**–ö–æ–¥:** `ai`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ AI Service.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `AIStrategy` (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–º—ã—Å–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

**–ü—Ä–∏–º–µ—Ä:**
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: `["—Ä–∞–±–æ—Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º"]`
- –°–æ–æ–±—â–µ–Ω–∏–µ: "–ù—É–∂–µ–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ PHP"
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ (—Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏ –±–ª–∏–∑–∫–æ)

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º

### Free

- –¢–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è `simple`
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MAX_KEYWORDS` –æ–ø—Ü–∏—é)

### Base

- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ `simple` –∏ `morpho`
- –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤

### Premium

- –í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏: `simple`, `morpho`, `ai`
- –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤

## –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞

### –ß–µ—Ä–µ–∑ Bot

–î–∏–∞–ª–æ–≥ `SetupFilterConversation`:

1. **–®–∞–≥ 1 (Name):** –ó–∞–ø—Ä–æ—Å –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
2. **–®–∞–≥ 2 (Keywords):** –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–∞—Ä–∏—Ñ—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–®–∞–≥ 3 (Strategy):** –í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –ø–æ–∏—Å–∫–∞
   - –ö–Ω–æ–ø–∫–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ —Ç–∞—Ä–∏—Ñ—É, –ø–æ–º–µ—á–∞—é—Ç—Å—è üîí –∏–ª–∏ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è
4. **–®–∞–≥ 4 (Confirm):** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

### –ß–µ—Ä–µ–∑ API (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)

```http
POST /api/monitoring/filters
Content-Type: application/json

{
  "name": "–†–∞–±–æ—Ç–∞ PHP",
  "chatId": 123456789,
  "keywords": ["php", "laravel", "symfony"],
  "strategy": "simple"
}
```

## –°–≤—è–∑—ã–≤–∞–Ω–∏–µ —Å –≥—Ä—É–ø–ø–∞–º–∏

–§–∏–ª—å—Ç—Ä—ã —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —Å –≥—Ä—É–ø–ø–∞–º–∏ —á–µ—Ä–µ–∑ Many-to-Many —Å–≤—è–∑—å.

**–õ–æ–≥–∏–∫–∞:**
- –û–¥–∏–Ω —Ñ–∏–ª—å—Ç—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≥—Ä—É–ø–ø–∞–º
- –û–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Å–≤—è–∑–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–∏–≥–Ω–∞–ª –≤ Monitoring Context –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ "–ö–∞—Ä—Ç—ã –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π"

## –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è

–§–∏–ª—å—Ç—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è.

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è, –Ω–æ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è
- –ü—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä —Å–Ω–æ–≤–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è

## BroadcastMatcher

–°–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏.

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è —á–∞—Ç–∞ (`enabled = true`)
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞:
   - –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –∏ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
   - –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ - –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–æ–≤–ø–∞–≤—à–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```php
$matcher = $this->broadcastMatcher;
$matchedFilters = $matcher->match($message, $chatId);

foreach ($matchedFilters as $filter) {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É
    $this->sendNotification($filter->getOwnerId(), $message);
}
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `monitoring_filters`:
- `id` (PK) - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- `owner_id` (FK) - ID –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `name` - –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞
- `chat_id` - ID —á–∞—Ç–∞
- `keywords` (JSON) - –ú–∞—Å—Å–∏–≤ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- `enabled` - –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ñ–∏–ª—å—Ç—Ä
- `strategy` - –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_owner_id` - –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `idx_chat_id` - –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —á–∞—Ç–∞
- `idx_enabled` - –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–û–±–∑–æ—Ä Monitoring Context](overview.md)
- [–°–µ—Å—Å–∏–∏](sessions.md)
- [–ö–∞—Ä—Ç–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π](intersection-map.md)
- [Billing Context - –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤](../billing/permissions.md)
