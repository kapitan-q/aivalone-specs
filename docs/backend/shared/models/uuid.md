# UUID Value Object Specification

## Назначение

`UUID` — базовый **Value Object**, предназначенный для представления уникальных идентификаторов в системе Aivalone.

В качестве базовой реализации и генератора UUID используется библиотека **ramsey/uuid**.

UUID применяется как фундаментальный тип для специализированных идентификаторов домена:

* `UserId`
* `TariffId`
* и других ID в системе

Цели:

* единый стандарт идентификаторов
* строгая валидация
* типобезопасность
* неизменяемость

## Используемая библиотека

**ramsey/uuid**

Причины выбора:

* де-факто стандарт в PHP-экосистеме
* поддержка RFC 4122
* строгая типизация (`UuidInterface`)
* надежная генерация UUID v4
* активная поддержка

Value Object **инкапсулирует** использование `ramsey/uuid` и не протекает наружу API.

## Описание

`UUID` инкапсулирует объект `Ramsey\Uuid\UuidInterface`
и гарантирует, что внутри всегда хранится валидный UUID.

Характеристики:

* immutable
* сравнение по значению
* не содержит бизнес-логики
* не зависит от инфраструктуры

### Формат UUID

Поддерживаемый формат (RFC 4122):
`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`

## Создание UUID

### Из строки

UUID может быть создан из строки (например, при загрузке из БД).

* Выполняется валидация через `Ramsey\Uuid\Uuid::fromString`
* При некорректном формате выбрасывается исключение

### Генерация

UUID может быть сгенерирован автоматически:

* используется `Ramsey\Uuid\Uuid::uuid4()`
* генерация скрыта за фабричным методом Value Object

## Основные методы

* `__construct(UuidInterface $uuid)`
  * внутренний конструктор
  * используется фабриками

* `static fromString(string $value): self`
  * создает UUID из строки
  * выбрасывает [InvalidUuidException](../exceptions/invalid-uuid-exception.md)

* `static generate(): self`
  * генерирует новый UUID (v4)

* `toString(): string`
  * возвращает строковое представление UUID

* `equals(UUID $other): bool`
  * сравнение двух UUID по значению

## Исключения

* **[InvalidUuidException](../exceptions/invalid-uuid-exception.md)** выбрасывается если:
    * строка не соответствует формату UUID
    * невозможно создать `UuidInterface`

## Инварианты

* UUID всегда валиден
* UUID не может быть `null` или пустым
* UUID неизменяем после создания

## Использование в домене

Базовый `UUID` **не используется напрямую** в доменных моделях.

Для доменной семантики создаются специализированные Value Objects:

* `UserId extends UUID`
* `TariffId extends UUID`
* `MessageId extends UUID`

Это сохраняет читаемость домена и предотвращает логические ошибки.

## Архитектурные замечания

* Относится к моделям доменного уровня (Domain Model)
* Не зависит от ORM или фреймворков
* `ramsey/uuid` используется только внутри реализации
* При необходимости библиотека может быть заменена без изменения контракта

## Связанные документы

* [Shared Context Overview](../overview.md)
* [Models](./overview.md)
* [ramsey/uuid documentation](https://github.com/ramsey/uuid)

## Статус

* [] Подключена библиотека `ramsey/uuid`
* [] Реализован Value Object `UUID`
* [] Реализованы фабрики `fromString` и `generate`
* [] Добавлены unit-тесты
