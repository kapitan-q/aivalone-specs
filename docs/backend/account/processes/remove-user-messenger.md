# RemoveUserMessenger Process Specification

## Назначение

Процесс **удаления мессенджера у существующего пользователя** в системе Aivalone.
Позволяет управлять каналами связи пользователя, удаляя ненужные или устаревшие мессенджеры.

## Предусловия

* Пользователь должен существовать в системе (идентифицируется по `UserId`).
* Мессенджер должен быть привязан к пользователю:

  * `messengerCode` — код мессенджера (например, 'TELEGRAM', 'WHATSAPP')
  * `messengerId` — идентификатор пользователя в выбранном мессенджере

## Поток выполнения

1. **Валидация данных**

   * Проверка существования пользователя по `UserId`.
   * Проверка, что указанный мессенджер привязан к пользователю.

2. **Удаление мессенджера**

   * Вызов сервиса `UserService::removeMessenger(userId, messengerCode, messengerId)`.
   * `UserService` удаляет объект `UserMessenger` из коллекции пользователя согласно модели.

3. **Сохранение изменений пользователя**

   * Сохранение пользователя и вложенных данных через `UserRepository::save(User)`.

4. **Публикация событий**
   * Публикация накопленных событий доменной модели

## Исключения / Ошибки

* Пользователь не найден — выбрасывается [UserNotFoundException](../exceptions/user-not-found-exception.md).
* Мессенджер не найден у пользователя — выбрасывается [MessengerNotFoundException](../exceptions/messenger-not-found-exception.md).

## Примечания

* Процесс является частью **Application Layer**.
* `UserService` отвечает за все бизнес-инварианты модели `User`.

## Связанные документы

* [Процессы](./overview.md)
* [User](../model/user.md)
* [UserService](../services/user-service.md)