# CreateUserProcess  Specification

## Назначение

Процесс **регистрации нового пользователя** в системе Aivalone. 
Отвечает за создание пользователя с минимальной информацией (messenger) и присвоение начального тарифа.

## Предусловия

* Пользователь должен предоставить:
  * `messengerCode` — код мессенджера (например, 'TELEGRAM')
  * `messengerId` — идентификатор пользователя в выбранном мессенджере

* Messenger должен быть уникальным в системе (не должно быть другого пользователя с таким же `messengerCode` и `messengerId`).

## Поток выполнения

1. **Валидация данных**
   * Проверка наличия `messengerCode` и `messengerId`.
   * Проверка уникальности комбинации `messengerCode` + `messengerId`.

2. **Создание пользователя**
   * Cоздание нового объекта `User` и инициализация всей внутренней структуры согласно спецификации модели

3. **Сохранение пользователя**
   * Сохранение пользователя через `UserRepository::save(User)`.

4. **Публикация событий**
   * Публикация накопленных событий доменной модели

## Исключения / Ошибки

* Если `messengerCode` или `messengerId` отсутствуют — генерация `ValidationException`.
* Если пользователь с данным `messengerCode` и `messengerId` уже существует — генерация `DuplicateUserException`.

## Примечания

* Регистрация возможна только через один мессенджер (по умолчанию) — дальнейшие мессенджеры добавляются отдельным процессом `AddUserMessenger`.

## Связанные документы

* [Процессы](./overview.md)
* [User](../model/user.md)
* [UserService](../services/user-service.md)
* [AddUserMessenger](./add-user-messenger.md)