# Обзор контекста Account

## Назначение

**Account Context** отвечает за управление пользователями системы и их авторизацией. Он обеспечивает:

* регистрацию и идентификацию пользователей через мессенджеры
* хранение информации о пользователях и их связях с мессенджерами
* интеграцию с другими контекстами (например, Billing и Bot)

Контекст построен по принципам **DDD** и является автономной частью `Core Backend`, что позволит в будущем при необходимости выделить его в отдельный сервис.

---

## Основные функции

1. **Управление пользователями**

   * Регистрация и хранение данных пользователя
   * Поддержка нескольких мессенджеров для одного пользователя (на данный момент — только Telegram)
   * Генерация и хранение уникальных идентификаторов (UserId)

2. **Авторизация и права доступа**

   * По умолчанию каждый пользователь имеет тариф `FREE`
   * Каждый пользователь может иметь активными несколько тарифов, например `FREE`, `FREE_ADDON` и тп

3. **Интеграция с другими контекстами**

   * **Billing Context** — управление тарифами и подписками, обработка событий об изменении тарифа
   * **Bot Context** — предоставление информации о пользователе для бота, обработка команд

---

## Доменные модели (high-level)

| Модель                  | Описание                                                                |
| ----------------------- | ----------------------------------------------------------------------- |
| **User**                | Основной объект пользователя                                            |
| **UserMessenger**       | Связь пользователя с конкретным мессенджером (Telegram, WhatsApp и др.) |
| **Permission / Access** | Информация о правах пользователя и текущем тарифе                       |

---

## Основные сценарии использования

* Регистрация нового пользователя через Telegram
* Привязка мессенджера к существующему пользователю
* Получение информации о тарифе и правах доступа
* Обработка событий изменения тарифов от Billing Context
* Проверка прав доступа при выполнении команд через бота

---

## Взаимодействие с другими контекстами

| Контекст | Тип взаимодействия  | Примеры                                                      |
| -------- | ------------------- | ------------------------------------------------------------ |
| Billing  | События / Слушатели | `UserSubscribedEvent`, `UserPermissionsUpdatedEvent`         |
| Bot      | Порты / Сервисы     | Получение данных пользователя по Telegram ID для работы бота |

---

## Структура контекста (файловая)

```
src/Context/Account/
├── Domain
|  ├── Model/             # Доменные модели (User, UserMessenger, Permission)   
|  └── Repository/        # Интерфейсы репозиториев
├── Application
|  ├── Service/           # Бизнес-логика и сервисы
|  ├── Command/           # Команды, которые контекст принимает от других контекстов
|  ├── Event/             # События, которые контекст инициирует
|  └── EventHandler/      # События, которые контекст слушает
├── Infrastructure
|  └── Persistence
|     └── Doctrine
|        ├── Entity       # ORM Entity для доменных моделей
|        ├── Repository   # Реализации репозиториев
|        └── Mappers      # Мапперы данных (при необходимости)
└── Presentation
   ├── Http
   |  └── Controller/     # REST API / Контроллеры (если нужно)
   └── CLI
      └── Command/        # CLI команды выполняемые контекстом
```

---

## Технологии и особенности

* Все операции построены с учетом DDD и идемпотентности

---

## Связанные документы

* [Backend Overview](../overview.md)
* [Модели](./model/overview.md)
* [События](./events/overview.md)
* [Сервисы](./services/overview.md)
* [Процессы](./processes/overview.md)